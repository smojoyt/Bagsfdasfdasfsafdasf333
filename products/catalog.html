<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Karry Kraze Catalog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
    <script src="/js/helpers.js"></script>

</head>




<body class="bg-white text-gray-900">
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>

    <div class="p-4 flex flex-wrap items-center justify-center gap-4">

        <!-- Category filters -->
        <div data-filter-group="category">
            <button class="filter-btn bg-gray-100 px-4 py-2 rounded" data-filter="">All</button>
            <button class="filter-btn bg-gray-100 px-4 py-2 rounded" data-filter=".bags">Bags</button>
            <button class="filter-btn bg-gray-100 px-4 py-2 rounded" data-filter=".headwear">Headwear</button>
        </div>

        <!-- Tag filters -->
        <div data-filter-group="tags">
            <button class="filter-btn bg-gray-100 px-4 py-2 rounded" data-filter="">All</button>
            <button class="filter-btn bg-gray-100 px-4 py-2 rounded" data-filter=".bestseller">Bestsellers</button>
            <button class="filter-btn bg-gray-100 px-4 py-2 rounded" data-filter=".onsale">On Sale</button>
            <button class="filter-btn bg-gray-100 px-4 py-2 rounded" data-filter=".outofstock">Out of Stock</button>
        </div>

        <!-- Sort Dropdown -->
        <select id="sort-select" class="ml-4 border p-2 rounded">
            <option value="original-order">Default</option>
            <option value="name">Name A–Z</option>
            <option value="price-low">Price Low–High</option>
            <option value="price-high">Price High–Low</option>
        </select>
    </div>


    <!-- Product Grid -->
    <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-4"></div>

    <!-- Script to Load and Activate -->
    <script>
        let filters = {}; // stores selected filters by group

        function concatFilters(obj) {
            return Object.values(obj).filter(Boolean).join('');
        }

        // Fetch + render products
        fetch("https://www.karrykraze.com/products/products.json")
            .then(res => res.json())
            .then(products => {
                const container = document.getElementById("product-grid");
                let html = "";

                Object.entries(products).forEach(([sku, product]) => {
                    const card = renderCatalogCard(product);
                    container.insertAdjacentHTML('beforeend', card);
                });


                container.innerHTML = html;

                const iso = new Isotope(container, {
                    itemSelector: '.item',
                    layoutMode: 'fitRows',
                    getSortData: {
                        name: '[data-name]',
                        'price-low': '[data-price] parseFloat',
                        'price-high': '[data-price] parseFloat'
                    }
                });

                // Filtering logic
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', e => {
                        const group = btn.closest('[data-filter-group]').getAttribute('data-filter-group');
                        const filter = btn.getAttribute('data-filter');

                        // Update filter for the group
                        filters[group] = filter;

                        // Apply combined filter
                        iso.arrange({ filter: concatFilters(filters) });
                    });
                });

                // Sort logic
                document.getElementById('sort-select').addEventListener('change', e => {
                    const val = e.target.value;
                    if (val === 'price-high') {
                        iso.updateSortData();
                        iso.arrange({ sortBy: 'price-low', sortAscending: false });
                    } else if (val === 'price-low') {
                        iso.updateSortData();
                        iso.arrange({ sortBy: 'price-low', sortAscending: true });
                    } else {
                        iso.arrange({ sortBy: val });
                    }
                });
            });
    </script>


</body>


</html>
