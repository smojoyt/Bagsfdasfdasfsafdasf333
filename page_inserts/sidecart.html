<!-- Sidebar Cart -->
<div id="cartSidebar" class="fixed top-0 right-0 w-80 max-w-full h-full bg-white shadow-lg border-l z-50 transform translate-x-full transition-transform duration-300">
    <div class="flex justify-between items-center p-4 border-b">
        <h2 class="text-lg font-semibold">Your Cart</h2>
        <button onclick="toggleCart()">✕</button>
    </div>
    <div id="cartItems" class="p-4 space-y-4 overflow-y-auto max-h-[70vh]"></div>
    <div class="p-4 border-t">
        <div id="cartTotal" class="text-right font-bold mb-4">Subtotal: $0.00</div>
        <button onclick="goToCheckout()" class="w-full bg-black text-white py-2 px-4 rounded hover:bg-gray-800">Checkout</button>
    </div>
</div>

<!-- Cart Open Button -->
<button class="fixed bottom-4 right-4 bg-black text-white p-3 rounded-full shadow-lg z-50" onclick="toggleCart()">🛒</button>

<script>
  function renderCart() {
    const savedCart = JSON.parse(localStorage.getItem("savedCart")) || [];
    const cartItems = document.getElementById("cartItems");
    const cartTotal = document.getElementById("cartTotal");

    if (!cartItems || !cartTotal || !productCatalog) return;

    cartItems.innerHTML = "";
    let total = 0;

    savedCart.forEach(item => {
      const data = productCatalog[item.sku];
      if (!data) return;

      const lineTotal = data.price * item.qty;
      total += lineTotal;

      cartItems.innerHTML += `
        <div class="flex items-start gap-3">
          <img src="${data.image}" alt="${data.name}" class="w-16 h-16 rounded border" />
          <div class="flex-1 text-sm">
            <strong>${data.name}</strong><br>
            Variant: ${item.variant}<br>
            Qty: ${item.qty} x $${data.price.toFixed(2)}<br>
            <button onclick="removeFromCart('${item.sku}', '${item.variant}')" class="text-red-500 mt-1">Remove</button>
          </div>
        </div>
      `;
    });

    cartTotal.innerText = "Subtotal: $" + total.toFixed(2);
  }

  function toggleCart() {
    document.getElementById("cartSidebar").classList.toggle("translate-x-full");
  }

  function removeFromCart(sku, variant) {
    let savedCart = JSON.parse(localStorage.getItem("savedCart")) || [];
    savedCart = savedCart.filter(item => !(item.sku === sku && item.variant === variant));
    localStorage.setItem("savedCart", JSON.stringify(savedCart));
    renderCart();
  }

  function goToCheckout() {
    const savedCart = JSON.parse(localStorage.getItem("savedCart")) || [];
    if (savedCart.length === 0) return;

    const skuList = savedCart.map(item => item.sku);
    const skuParam = encodeURIComponent(skuList.join(","));
    window.location.href = `https://checkout.karrykraze.com?autocart=${skuParam}`;
  }

  window.onload = renderCart;
</script>
