<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Favicon -->
    <link rel="icon" href="/imgs/Logo/Short/SL_0603.png" type="image/png" />
    <title>Sign Up – Karry Kraze</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <!-- Custom Scripts -->
    <script src="/js/helpers.js"></script>
    <script src="/js/moreItemsCarousel.js"></script>
    <script src="/js/loadProductData.js"></script>
    <script src="/js/uni_navbar.js"></script>
    <style>
        .quality-btn.selected {
            background-color: black;
            color: white;
        }

        mark.bg-yellow-200 {
            padding: 0 2px;
            border-radius: 0.25rem;
        }
    </style>

</head>
<body class="bg-[#fef1e7] text-gray-800 font-sans">
    <div class="mt-20 max-w-3xl mx-auto px-4 md:px-8 space-y-8">
        <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 uppercase underline text-center mb-4">
            💸 Get $5 Off Your First Order
        </h1>
        <p class="text-center text-base text-gray-700">Sign up below to receive your exclusive coupon instantly via email.</p>

        <form id="couponForm" class="space-y-6 mt-6">
            <!-- Name Fields -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block font-semibold mb-1">First Name *</label>
                    <input type="text" name="firstName" required class="w-full p-2 border rounded" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Last Name *</label>
                    <input type="text" name="lastName" required class="w-full p-2 border rounded" />
                </div>
            </div>

            <!-- Email & Phone -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block font-semibold mb-1">Email Address *</label>
                    <input type="email" name="email" required class="w-full p-2 border rounded" />
                </div>
                <div>
                    <label class="block font-semibold mb-1">Phone Number *</label>
                    <input type="tel" name="phone" required class="w-full p-2 border rounded" />
                </div>
            </div>

            <!-- Consent -->
            <div class="space-y-2 text-sm text-gray-700">
                <label class="flex items-start gap-2">
                    <input type="checkbox" name="smsConsent" required class="mt-1 accent-red-500" />
                    I agree to receive promotional SMS messages from Karry Kraze.
                </label>
                <label class="flex items-start gap-2">
                    <input type="checkbox" name="emailConsent" required class="mt-1 accent-red-500" />
                    I agree to receive marketing emails from Karry Kraze.
                </label>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="bg-black text-white py-2 px-6 rounded hover:bg-gray-800 w-full font-semibold">
                Claim My Coupon
            </button>
        </form>

        <!-- Success Message -->
        <div id="couponMessage" class="hidden mt-8 text-center">
            <p class="text-green-700 font-semibold text-lg mb-4">🎉 Your coupon is on the way! Check your inbox.</p>
            <a href="/products/catalog.html" class="inline-block bg-black hover:bg-gray-800 text-white px-6 py-2 rounded font-medium">
                Browse the Shop
            </a>
        </div>
    </div>


    <!-- Footer -->
    <div id="footer"></div>
    <div id="navbar-container"></div>

    <script>
        document.getElementById('couponForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const form = e.target;
            const data = Object.fromEntries(new FormData(form).entries());

            const res = await fetch('https://hook.us2.make.com/mebf3tl39n3o3gx11ywaeta6f7eo1yja', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const messageBox = document.getElementById('couponMessage');
            const messageText = messageBox.querySelector('p');
            const useNowBtn = messageBox.querySelector('a');

            if (res.ok) {
                const json = await res.json();

                form.style.display = 'none';
                messageBox.classList.remove('hidden');

                if (json.status === 'already_redeemed') {
                    messageText.textContent = json.message;

                    // If message includes "expired" or "redeemed", hide the button
                    if (json.message.includes('expired') || json.message.includes('redeemed')) {
                        useNowBtn.classList.add('hidden');
                    } else {
                        useNowBtn.classList.remove('hidden');
                    }
                } else {
                    messageText.textContent = '🎉 Your coupon is on the way! Check your inbox.';
                    useNowBtn.classList.remove('hidden');
                }
            } else {
                alert('Something went wrong. Please try again.');
            }
        });










        // Other included HTML
        function includeHTML(id, filePath, callback = null) {
            fetch(filePath)
                .then(res => res.text())
                .then(html => {
                    document.getElementById(id).innerHTML = html;
                    if (callback) callback();
                });
        }

        function initNavbar() {
            const toggleBtn = document.getElementById("mobile-menu-button");
            const menu = document.getElementById("mobile-menu");
            if (toggleBtn && menu) toggleBtn.addEventListener("click", () => menu.classList.toggle("hidden"));

            const cart = JSON.parse(localStorage.getItem("savedCart")) || [];
            const totalQty = cart.reduce((sum, item) => sum + (item.qty || 1), 0);
            const countElem = document.getElementById("cart-count");
            if (countElem) countElem.textContent = totalQty;

            const navbar = document.getElementById('mainNavbar');
            let lastScrollY = window.scrollY;
            window.addEventListener('scroll', () => {
                if (!navbar) return;
                if (window.scrollY > lastScrollY && window.scrollY > 50) {
                    navbar.classList.replace('navbar-show', 'navbar-hide');
                } else {
                    navbar.classList.replace('navbar-hide', 'navbar-show');
                }
                lastScrollY = window.scrollY;
            });
        }

        // 🔁 Main Load Flow
        includeHTML("navbar-container", "/page_inserts/uni_navbar.html", () => {
            initNavbar();

            const addToCartBtn = document.getElementById("add-to-cart-btn");
            if (addToCartBtn) {
                addToCartBtn.addEventListener("click", () => {
                    const variant = document.getElementById("variantSelector")?.value || null;
                    addToCart(activeProduct, variant);
                });
            }

            includeHTML("footer", "/page_inserts/footer.html");
        });

    </script>
</body>
</html>
