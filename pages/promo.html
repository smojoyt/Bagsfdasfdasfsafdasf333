<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promo – Karry Kraze</title>

    <!-- Social Meta -->
    <meta property="og:title" content="Promo – Karry Kraze" />
    <meta property="og:description" content="Save big on exclusive deals – only at Karry Kraze!" />
    <meta property="og:image" content="https://www.karrykraze.com/imgs/Promo/default.jpg" />
    <meta property="og:url" content="https://www.karrykraze.com/pages/promo" />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Promo – Karry Kraze" />
    <meta name="twitter:description" content="Save big on exclusive deals – only at Karry Kraze!" />
    <meta name="twitter:image" content="https://www.karrykraze.com/imgs/Promo/default.jpg" />

    <link rel="icon" href="/imgs/Logo/Short/SL_White_01.png" type="image/png" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="text-gray-800 bg-orange-100">
    <!-- Dynamic Promo Banner -->
    <div id="promo-banner"></div>

    <div class="max-w-7xl mx-auto px-4 py-8 relative z-10">
        <!-- Title -->
        <h1 id="promo-title" class="text-3xl font-bold mb-4 text-center">Promo</h1>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

        <!-- Feature Section -->
        <div class="mt-12" id="promo-feature">
            <div id="fade-wrapper" class="fade-wrapper flex flex-col lg:flex-row gap-6">
                <div class="w-full lg:w-1/2">
                    <img id="model-image" src="" alt="Model" class="w-full rounded-lg shadow object-cover max-h-[400px] sm:max-h-[500px]" />
                </div>
                <div class="w-full lg:w-1/2">
                    <div id="carousel-product-card" class="bg-white rounded-lg shadow p-6 sm:p-8 flex flex-col justify-between w-full h-full">
                        <div class="flex flex-col gap-3">
                            <h2 id="carousel-name" class="text-2xl sm:text-3xl lg:text-4xl font-bold leading-tight"></h2>
                            <div id="carousel-price" class="text-lg sm:text-xl"></div>
                            <ul id="carousel-description" class="text-base sm:text-lg pt-2 list-disc list-inside text-gray-700"></ul>
                            <div id="carousel-variants" class="mt-4 flex flex-wrap gap-3"></div>
                        </div>
                        <button id="carousel-buy-btn" class="bg-black text-white px-6 py-3 rounded mt-6 hover:bg-gray-900">More Info</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Carousel Controls -->
        <div class="flex justify-between items-center mt-8 gap-4">
            <button id="prev-btn" class="text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <div id="carousel-thumbs" class="p-1 flex gap-2 overflow-x-auto w-full sm:w-auto justify-center"></div>
            <button id="next-btn" class="text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>
    </div>

    <script>
        async function loadPromoPage() {
            const promoRes = await fetch('/products/promotion.json');
            const productRes = await fetch('/products/products.json');
            const promoData = await promoRes.json();
            const productData = await productRes.json();
            const now = new Date();

            const promo = promoData.promotions.find(p =>
                (!p.startDate || new Date(p.startDate) <= now) &&
                (!p.endDate || new Date(p.endDate) >= now) &&
                p.featured && p.media
            );

            if (!promo) return;

            const products = Object.values(productData).filter(p => p.category === promo.category);

            // Banner
            const banner = document.getElementById("promo-banner");
            banner.innerHTML = `
                    <img src="${promo.media.image}" alt="${promo.media.headline}" class="w-full object-cover max-h-[400px]" />
                `;

            // Title
            document.getElementById("promo-title").textContent = promo.name;

            // Product Grid
            const grid = document.getElementById("product-grid");
            products.slice(0, 9).forEach(p => {
                const hover = p.thumbnails?.[1] || p.image;
                const card = document.createElement('div');
                card.className = "relative group bg-white p-2 rounded-xl shadow hover:shadow-lg overflow-hidden";
                card.innerHTML = `
                        <a href="${p.url}" class="block">
                            <div class="relative">
                                <img src="${p.image}" class="w-full object-contain rounded-lg transition duration-300 group-hover:opacity-0">
                                <img src="${hover}" class="w-full object-contain rounded-lg absolute top-0 left-0 opacity-0 group-hover:opacity-100 transition duration-300">
                            </div>
                            <div class="mt-2">
                                <h2 class="font-semibold text-sm line-clamp-2">${p.name}</h2>
                                <div class="text-base text-gray-800 font-medium">$${p.sale_price ?? p.price}</div>
                            </div>
                        </a>`;
                grid.appendChild(card);
            });

            // Carousel Feature
            let current = 0;
            const nameEl = document.getElementById("carousel-name");
            const priceEl = document.getElementById("carousel-price");
            const descEl = document.getElementById("carousel-description");
            const buyBtn = document.getElementById("carousel-buy-btn");
            const thumbs = document.getElementById("carousel-thumbs");
            const variantEl = document.getElementById("carousel-variants");
            const modelEl = document.getElementById("model-image");

            function updateCarousel(index) {
                const p = products[index];
                nameEl.textContent = p.name;
                priceEl.innerHTML = `$${p.sale_price ?? p.price}`;
                descEl.innerHTML = (p.descriptionList || []).map(d => `<li>${d}</li>`).join('');
                buyBtn.onclick = () => window.location.href = p.url;

                modelEl.src = p.thumbnails?.[1] || p.image;

                variantEl.innerHTML = '';
                (p.custom1Options?.split('|') || []).forEach((color, i) => {
                    const btn = document.createElement('button');
                    btn.className = `w-6 h-6 rounded-full border ${i === 0 ? 'ring ring-black' : ''}`;
                    btn.style.backgroundColor = color.trim().toLowerCase();
                    btn.onclick = () => modelEl.src = p.variantImages?.[color.trim()] || p.image;
                    variantEl.appendChild(btn);
                });

                Array.from(thumbs.children).forEach((el, i) => {
                    el.classList.toggle("ring", i === index);
                    el.classList.toggle("ring-black", i === index);
                });

                current = index;
            }

            products.forEach((p, i) => {
                const img = document.createElement('img');
                img.src = p.image;
                img.className = "w-12 h-12 object-contain cursor-pointer rounded-lg";
                img.onclick = () => updateCarousel(i);
                thumbs.appendChild(img);
            });

            document.getElementById("prev-btn").onclick = () => updateCarousel((current - 1 + products.length) % products.length);
            document.getElementById("next-btn").onclick = () => updateCarousel((current + 1) % products.length);

            updateCarousel(0);
        }

        loadPromoPage();
    </script>
</body>
</html>
