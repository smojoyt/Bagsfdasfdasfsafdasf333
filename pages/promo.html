<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promo – Karry Kraze</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">
    <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
    <script src="/js/helpers.js"></script>
    <script src="/js/moreItemsCarousel.js"></script>
    <script src="/js/loadProductData.js"></script>
    <script src="/js/uni_navbar.js"></script>
    <style>
        body {
            background: #f5a442;
        }

        .carousel-cell {
            width: 100%;
        }

        .is-selected .ring {
            ring-width: 2px;
        }

        .fade-wrapper {
            display: flex;
            gap: 2rem;
            opacity: 1;
            transform: translateX(0);
            transition: none;
        }

        .fade-exit-left {
            animation: fadeOut 0.5s forwards;
        }

        .fade-enter-right {
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .swatch-button {
            transition: all 0.3s ease;
            position: relative;
        }

            .swatch-button.selected::after {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border: 2px solid black;
                border-radius: 9999px;
                box-shadow: 0 0 0 2px white;
            }
    </style>

</head>
<body class="text-gray-800">
    <!-- Banner Image -->
    <!-- Full-width Banner (outside container) -->
    <div class="w-full">
        <img src="/imgs/Banner/promo-banner.jpg" alt="Promo Banner" class="w-full object-cover max-h-[300px] sm:max-h-[400px] lg:max-h-[500px]" />
    </div>
    <div class="max-w-7xl mx-auto px-4 py-8 relative z-10">



        <!-- Title -->
        <h1 id="promo-title" class="text-3xl font-bold mb-4 text-center">Promo</h1>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

        <!-- Feature Section -->
        <div class="mt-12" id="promo-feature">
            <div id="fade-wrapper" class="fade-wrapper flex flex-col lg:flex-row gap-6">
                <!-- Model Image -->
                <div class="w-full lg:w-1/2">
                    <img id="model-image" src="" alt="Model" class="w-full rounded-lg shadow object-cover max-h-[400px] sm:max-h-[500px]" />
                </div>

                <!-- Carousel Product Card -->
                <div class="w-full lg:w-1/2">
                    <div id="carousel-product-card" class="text-base leading-7 bg-white rounded-lg shadow p-6 sm:p-8 flex flex-col justify-between transition-all w-full h-full">
                        <div class="flex flex-col gap-3">
                            <h2 id="carousel-name" class="text-2xl sm:text-3xl lg:text-4xl font-bold leading-tight"></h2>
                            <div id="carousel-price" class="text-lg sm:text-xl"></div>
                            <ul id="carousel-description" class="text-base sm:text-lg pt-2 list-disc list-inside text-gray-700"></ul>
                            <div id="carousel-variants" class="mt-4 flex flex-wrap gap-3"></div>
                        </div>
                        <button id="carousel-buy-btn" class="bg-black text-white px-6 py-3 rounded mt-6 hover:bg-gray-900 w-full sm:w-fit text-center">Buy Now</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Carousel Controls -->
        <div class="flex justify-between items-center mt-8 gap-4">
            <button id="prev-btn" class="text-lg flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>

            <div id="carousel-thumbs" class="p-1 flex gap-2 overflow-x-auto w-full sm:w-auto justify-center"></div>

            <button id="next-btn" class="text-lg flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>
    </div>


    <script>
        const promoConfig = {
            title: "",
            category: "headwear",
            modelImage: "https://www.karrykraze.com/imgs/Products/Hats/FuzzyBeanie/FB_7.jpg"
        };
    </script>
    <script>
        fetch('/products/products.json')
            .then(res => res.json())
            .then(products => {
                const entries = Object.values(products).filter(p => p.category === promoConfig.category);
                const grid = document.getElementById('product-grid');
                const title = document.getElementById('promo-title');
                const modelImg = document.getElementById('model-image');

                title.textContent = promoConfig.title;
                modelImg.src = entries[0]?.thumbnails?.[1] || entries[0]?.image || '';

                entries.slice(0, 9).forEach(product => {
                    const hover = product.thumbnails?.[1] || product.image;
                    const card = document.createElement('div');
                    card.className = "relative group bg-white p-2 rounded-xl shadow hover:shadow-lg overflow-hidden";

                    card.innerHTML = `
                                <a href="${product.url}" class="block">
                                  <div class="relative">
                                    <img src="${product.image}" class="w-full object-contain rounded-lg transition duration-300 group-hover:opacity-0">
                                    <img src="${hover}" class="w-full object-contain rounded-lg absolute top-0 left-0 opacity-0 group-hover:opacity-100 transition duration-300">
                                  </div>
                                  <div class="mt-2">
                                    <h2 class="font-semibold text-sm line-clamp-2">${product.name}</h2>
                                    ${getCompactPriceHTML(product)}
                                  </div>
                                </a>
                              `;

                    grid.appendChild(card);
                });

                let current = 0;
                const nameEl = document.getElementById("carousel-name");
                const priceEl = document.getElementById("carousel-price");
                const descEl = document.getElementById("carousel-description");
                const buyBtn = document.getElementById("carousel-buy-btn");
                const thumbs = document.getElementById("carousel-thumbs");
                const variantEl = document.getElementById("carousel-variants");
                const modelEl = document.getElementById("model-image");
                const wrapper = document.getElementById("fade-wrapper");

                function animateChange(cb) {
                    wrapper.classList.add("fade-exit-left");
                    setTimeout(() => {
                        cb();
                        wrapper.classList.remove("fade-exit-left");
                        wrapper.classList.add("fade-enter-right");
                        setTimeout(() => {
                            wrapper.classList.remove("fade-enter-right");
                            wrapper.classList.add("fade-final");
                            setTimeout(() => wrapper.classList.remove("fade-final"), 300);
                        }, 50);
                    }, 300);
                }

                function loadCard(index) {
                    const p = entries[index];
                    nameEl.textContent = p.name;
                    priceEl.innerHTML = getFullPriceHTML(p);
                    descEl.innerHTML = p.descriptionList?.map(d => `<li>${d}</li>`).join('');
                    buyBtn.onclick = () => window.location.href = p.url;

                    variantEl.innerHTML = '';
                    const colors = p.custom1Options.split('|');
                    colors.forEach((color, idx) => {
                        const clean = color.trim();
                        const btn = document.createElement('button');
                        btn.className = `w-6 h-6 rounded-full border swatch-button ${idx === 0 ? 'selected' : ''} ${getColorClass(clean)}`;
                        btn.addEventListener('click', () => {
                            modelEl.src = p.thumbnails?.[1] || p.image;
                            [...variantEl.children].forEach(b => b.classList.remove('selected'));
                            btn.classList.add('selected');
                        });
                        variantEl.appendChild(btn);
                    });

                    modelEl.src = p.thumbnails?.[1] || p.image;
                }

                function updateCarousel(index) {
                    current = index;
                    animateChange(() => loadCard(index));
                    Array.from(thumbs.children).forEach((el, i) => {
                        el.classList.toggle("ring", i === current);
                        el.classList.toggle("ring-black", i === current);
                    });
                }

                entries.forEach((p, i) => {
                    const img = document.createElement('img');
                    img.src = p.image;
                    img.className = "w-12 h-12 object-contain cursor-pointer rounded-lg";
                    img.onclick = () => updateCarousel(i);
                    thumbs.appendChild(img);
                });

                document.getElementById("prev-btn").onclick = () => updateCarousel((current - 1 + entries.length) % entries.length);
                document.getElementById("next-btn").onclick = () => updateCarousel((current + 1) % entries.length);

                updateCarousel(0);
            });
    </script>

</body>
</html>
