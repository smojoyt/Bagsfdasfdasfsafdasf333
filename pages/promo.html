<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promo – Karry Kraze</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">
    <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
    <script src="/js/helpers.js"></script>
    <script src="/js/moreItemsCarousel.js"></script>
    <script src="/js/loadProductData.js"></script>
    <script src="/js/uni_navbar.js"></script>
    <style>
        .carousel-cell {
            width: 100%;
        }

        .is-selected .ring {
            ring-width: 2px;
        }
    </style>
</head>
<body class="bg-white text-gray-800">
    <div class="max-w-7xl mx-auto px-4 py-8">
        <h1 id="promo-title" class="text-3xl font-bold mb-4 text-center">Promo</h1>

        <!-- Product Grid -->
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

        <!-- Carousel Feature Section -->
        <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            <div>
                <img id="model-image" src="" alt="Model" class="w-full rounded-lg shadow">
            </div>
            <div>
                <div id="carousel-product-card" class="bg-white rounded-lg shadow p-4">
                    <h2 id="carousel-name" class="text-xl font-bold"></h2>
                    <div id="carousel-price" class="my-2"></div>
                    <div id="carousel-description" class="text-sm text-gray-600 mb-4"></div>
                    <div id="carousel-variants" class="flex gap-2 mb-4"></div>
                    <button id="carousel-buy-btn" class="bg-black text-white px-4 py-2 rounded hover:bg-gray-900">Buy Now</button>
                </div>
                <div class="flex justify-between items-center mt-4">
                    <button id="prev-btn" class="text-lg">⬅️</button>
                    <div id="carousel-thumbs" class="flex gap-2 overflow-x-auto"></div>
                    <button id="next-btn" class="text-lg">➡️</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JS Config + Script -->
    <script>
    const promoConfig = {
      title: "🔥 $10 OFF All Hats!",
      tag: "Headwear",
      modelImage: "https://www.karrykraze.com/imgs/Products/Hats/FuzzyBeanie/FB_7.jpg"
    };
    </script>
    <script src="/helpers.js"></script>
    <script>
    fetch('/products/products.json')
      .then(res => res.json())
      .then(products => {
        const entries = Object.values(products).filter(p => p.tags?.includes(promoConfig.tag));
        const grid = document.getElementById('product-grid');
        const title = document.getElementById('promo-title');
        const modelImg = document.getElementById('model-image');

        title.textContent = promoConfig.title;
        modelImg.src = promoConfig.modelImage;

        entries.slice(0, 9).forEach(product => {
          const hover = product.thumbnails?.[1] || product.image;
          const card = document.createElement('div');
          card.className = "relative group bg-white p-2 rounded-xl shadow hover:shadow-lg overflow-hidden";

          card.innerHTML = `
            <a href="${product.url}" class="block">
              <div class="relative">
                <img src="${product.image}" class="w-full object-contain rounded-lg transition duration-300 group-hover:opacity-0">
                <img src="${hover}" class="w-full object-contain rounded-lg absolute top-0 left-0 opacity-0 group-hover:opacity-100 transition duration-300">
              </div>
              <div class="mt-2">
                <h2 class="font-semibold text-sm line-clamp-2">${product.name}</h2>
                ${getCompactPriceHTML(product)}
              </div>
            </a>
          `;

          grid.appendChild(card);
        });

        // Carousel Logic
        let current = 0;
        const nameEl = document.getElementById("carousel-name");
        const priceEl = document.getElementById("carousel-price");
        const descEl = document.getElementById("carousel-description");
        const buyBtn = document.getElementById("carousel-buy-btn");
        const thumbs = document.getElementById("carousel-thumbs");
        const variantEl = document.getElementById("carousel-variants");

        function loadCard(index) {
          const p = entries[index];
          nameEl.textContent = p.name;
          priceEl.innerHTML = getFullPriceHTML(p);
          descEl.innerHTML = p.descriptionList?.map(d => `<li>${d}</li>`).join('');
          buyBtn.onclick = () => window.location.href = p.url;

          variantEl.innerHTML = '';
          const colors = p.custom1Options.split('|');
          colors.forEach(color => {
            const clean = color.trim();
            const div = document.createElement('div');
            div.className = `w-6 h-6 rounded-full border ${getColorClass(clean)}`;
            div.addEventListener('click', () => {
              modelImg.src = p.variantImages?.[clean] || p.image;
            });
            variantEl.appendChild(div);
          });
        }

        function updateCarousel(index) {
          current = index;
          loadCard(index);
          Array.from(thumbs.children).forEach((el, i) => {
            el.classList.toggle("ring", i === current);
            el.classList.toggle("ring-black", i === current);
          });
        }

        entries.forEach((p, i) => {
          const img = document.createElement('img');
          img.src = p.image;
          img.className = "w-12 h-12 object-contain cursor-pointer rounded-lg";
          img.onclick = () => updateCarousel(i);
          thumbs.appendChild(img);
        });

        document.getElementById("prev-btn").onclick = () => updateCarousel((current - 1 + entries.length) % entries.length);
        document.getElementById("next-btn").onclick = () => updateCarousel((current + 1) % entries.length);

        updateCarousel(0);
      });
    </script>
</body>
</html>