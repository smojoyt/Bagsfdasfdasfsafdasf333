<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Canceled - Karry Kraze</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css" />
    <script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>
    <style>
        body {
            background-color: #fff8f0;
            color: #1f2937;
        }

        .carousel-cell {
            width: 180px;
            margin-right: 10px;
        }

            .carousel-cell img {
                width: 100%;
                border-radius: 0.75rem;
            }
    </style>
</head>
<body class="min-h-screen flex flex-col justify-center items-center text-center px-4 py-12">

    <div class="max-w-md w-full bg-white rounded-2xl shadow-lg p-6">
        <img src="/imgs/Logo/Short/4.jpg" alt="Karry Kraze Logo" class="w-20 mx-auto mb-4 rounded-full border">
        <h1 class="text-2xl font-bold mb-2">Order Canceled</h1>
        <p class="text-gray-600 mb-4">It looks like you didn’t complete your purchase. No worries — your cart is still saved!</p>

        <!-- Toast Notification -->
        <div class="bg-red-100 text-red-800 border border-red-200 rounded-md px-4 py-3 text-sm mb-4">
            You canceled your checkout. You can resume anytime.
        </div>

        <!-- Discount Banner -->
        <div class="bg-yellow-100 border border-yellow-300 text-yellow-900 rounded-lg px-4 py-3 text-sm mb-6">
            Use code <strong>KRAZE5</strong> at checkout for <strong>$5 off</strong> your order.
        </div>

        <!-- CTA Buttons -->
        <div class="flex flex-col gap-3">
            <a href="/products/catalog" class="bg-yellow-200 hover:bg-yellow-300 text-black font-semibold py-2 px-4 rounded transition uppercase">Return to Shop</a>
            <a href="mailto:support@karrykraze.com" class="text-sm underline text-gray-700 hover:text-black">Have questions? Contact us</a>
        </div>

        <!-- Order Summary -->
        <div class="mt-8 border-t pt-4 text-left text-sm">
            <h2 class="font-semibold mb-2">Order Summary</h2>
            <ul id="order-summary-list" class="text-gray-600"></ul>
        </div>
    </div>

    <!-- You May Also Like -->
    <div class="w-full max-w-5xl mt-12">
        <h2 class="text-2xl font-bold mb-4 text-center">You May Also Like</h2>
        <div class="carousel px-6" id="recommend-carousel"></div>
    </div>

    <script>
        // Load cart from localStorage and populate summary
        const cart = JSON.parse(localStorage.getItem("savedCart")) || [];
        const list = document.getElementById("order-summary-list");
        let total = 0;
        cart.forEach(item => {
            total += item.price * item.qty;
            list.innerHTML += `<li>👜 ${item.name}${item.variant ? ` - ${item.variant}` : ""} (x${item.qty})</li>`;
        });
        list.innerHTML += `<li class="mt-2 font-medium text-black">Total: $${total.toFixed(2)}</li>`;

        // Load product suggestions
        fetch("/products/products.json")
            .then(res => res.json())
            .then(products => {
                const container = document.getElementById("recommend-carousel");
                const entries = Object.entries(products)
                    .filter(([_, p]) => !p.tags?.includes("Discontinued") && !p.tags?.includes("Outofstock"))
                    .slice(0, 6);

                entries.forEach(([sku, p]) => {
                    const img = p.variantImages?.[Object.keys(p.variantImages ?? {})[0]] || p.image;
                    container.innerHTML += `
                <div class="carousel-cell">
                  <a href="/products/${sku}.html" class="block">
                    <img src="${img}" alt="${p.name}" class="mb-2">
                    <p class="font-semibold text-sm text-gray-800">${p.name}</p>
                    <p class="text-sm text-gray-600">$${(p.sale_price ?? p.price).toFixed(2)}</p>
                  </a>
                </div>
              `;
                });

                new Flickity(container, {
                    cellAlign: 'left',
                    contain: true,
                    pageDots: false,
                    groupCells: true
                });
            });
    </script>

</body>
</html>
